<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Meeting Notes Summarizer - Ollama</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-6 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ü§ñ AI Meeting Notes Summarizer</h1>
            <p class="text-gray-600 text-lg">Powered by Ollama - Local LLM Processing</p>
            <div id="statusIndicator" class="mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                <span class="mr-2">‚óè</span>
                <span id="statusText">Checking connection...</span>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Input Section -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Meeting Transcript
                    </label>
                    <textarea
                        id="transcriptInput"
                        placeholder="Paste your meeting transcript here...&#10;&#10;Example:&#10;John: We need to finalize the Q4 roadmap by next week.&#10;Sarah: Agreed. I'll coordinate with the design team.&#10;Mike: We decided to prioritize the mobile app feature..."
                        class="w-full h-96 p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                    ></textarea>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-500" id="charCount">0 characters</span>
                        <label class="cursor-pointer bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                            üìÅ Upload .txt
                            <input type="file" accept=".txt" id="fileInput" class="hidden">
                        </label>
                    </div>
                </div>

                <div class="flex space-x-4">
                    <button
                        id="analyzeBtn"
                        class="flex-1 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-colors font-medium disabled:bg-gray-300 disabled:cursor-not-allowed"
                    >
                        ‚ú® Analyze with AI
                    </button>
                    <button
                        id="clearBtn"
                        class="px-6 py-3 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                    >
                        Clear
                    </button>
                </div>

                <!-- Model Info -->
                <div class="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-gray-600">
                    <strong>Model:</strong> <span id="modelName">Loading...</span>
                </div>
            </div>

            <!-- Output Section -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">üìä AI Analysis</h2>

                <div id="loadingState" class="hidden text-center py-20">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-indigo-600 mx-auto mb-4"></div>
                    <p class="text-gray-600 text-lg">AI is analyzing your meeting...</p>
                    <p class="text-sm text-gray-500 mt-2">This may take 10-30 seconds</p>
                </div>

                <div id="emptyState" class="text-center py-20 text-gray-400">
                    <div class="text-6xl mb-4">üìù</div>
                    <p class="text-lg">Upload or paste a transcript to analyze</p>
                </div>

                <div id="resultsContainer" class="hidden space-y-6 max-h-[600px] overflow-y-auto pr-2">
                    <!-- Meeting Summary -->
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-800 mb-2">Meeting Summary</h3>
                        <p id="meetingSummary" class="text-gray-700 text-sm leading-relaxed"></p>
                    </div>

                    <!-- Participants -->
                    <div id="participantsSection" class="hidden">
                        <h3 class="font-semibold text-lg text-gray-800 mb-3 flex items-center">
                            üë• Participants
                        </h3>
                        <div id="participantsList" class="flex flex-wrap gap-2"></div>
                    </div>

                    <!-- Key Decisions -->
                    <div id="decisionsSection" class="hidden">
                        <h3 class="font-semibold text-lg text-gray-800 mb-3 flex items-center">
                            ‚úÖ Key Decisions
                        </h3>
                        <div id="decisionsList" class="space-y-2"></div>
                    </div>

                    <!-- Action Items -->
                    <div id="actionItemsSection" class="hidden">
                        <h3 class="font-semibold text-lg text-gray-800 mb-3 flex items-center">
                            üéØ Action Items
                        </h3>
                        <div id="actionItemsList" class="space-y-2"></div>
                    </div>

                    <!-- Discussion Points -->
                    <div id="discussionSection" class="hidden">
                        <h3 class="font-semibold text-lg text-gray-800 mb-3 flex items-center">
                            üí¨ Discussion Points
                        </h3>
                        <div id="discussionList" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let currentModel = 'llama3.2';

        // Elements
        const transcriptInput = document.getElementById('transcriptInput');
        const fileInput = document.getElementById('fileInput');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const clearBtn = document.getElementById('clearBtn');
        const charCount = document.getElementById('charCount');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const modelName = document.getElementById('modelName');
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');
        const resultsContainer = document.getElementById('resultsContainer');

        // Check health on load
        async function checkHealth() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();

                if (data.ollama_running) {
                    statusIndicator.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-green-100 text-green-800';
                    statusText.textContent = 'Ollama Connected';
                    currentModel = data.current_model;
                    modelName.textContent = currentModel;
                } else {
                    throw new Error('Ollama not running');
                }
            } catch (error) {
                statusIndicator.className = 'mt-4 inline-flex items-center px-4 py-2 rounded-full text-sm font-medium bg-red-100 text-red-800';
                statusText.textContent = 'Ollama Disconnected';
                modelName.textContent = 'Not connected';
                alert('Cannot connect to Ollama. Make sure:\n1. Ollama is installed\n2. Flask backend is running (python app.py)\n3. Model is pulled (ollama pull llama3.2)');
            }
        }

        // Character count
        transcriptInput.addEventListener('input', (e) => {
            charCount.textContent = `${e.target.value.length} characters`;
        });

        // File upload
        fileInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'text/plain') {
                const text = await file.text();
                transcriptInput.value = text;
                charCount.textContent = `${text.length} characters`;
            } else {
                alert('Please upload a .txt file');
            }
        });

        // Clear button
        clearBtn.addEventListener('click', () => {
            transcriptInput.value = '';
            charCount.textContent = '0 characters';
            emptyState.classList.remove('hidden');
            resultsContainer.classList.add('hidden');
        });

        // Analyze button
        analyzeBtn.addEventListener('click', async () => {
            const transcript = transcriptInput.value.trim();

            if (!transcript) {
                alert('Please enter a meeting transcript');
                return;
            }

            // Show loading
            emptyState.classList.add('hidden');
            resultsContainer.classList.add('hidden');
            loadingState.classList.remove('hidden');
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'ü§ñ Analyzing...';

            try {
                const response = await fetch(`${API_URL}/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ transcript })
                });

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                displayResults(data.analysis);
            } catch (error) {
                alert(`Error: ${error.message}`);
                emptyState.classList.remove('hidden');
            } finally {
                loadingState.classList.add('hidden');
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = '‚ú® Analyze with AI';
            }
        });

        function displayResults(analysis) {
            // Show results container
            resultsContainer.classList.remove('hidden');

            // Meeting Summary
            document.getElementById('meetingSummary').textContent = analysis.meeting_summary || 'No summary available';

            // Participants
            const participants = analysis.participants || [];
            if (participants.length > 0) {
                document.getElementById('participantsSection').classList.remove('hidden');
                document.getElementById('participantsList').innerHTML = participants
                    .map(p => `<span class="px-3 py-1 bg-indigo-100 text-indigo-800 rounded-full text-sm">${p}</span>`)
                    .join('');
            }

            // Decisions
            const decisions = analysis.key_decisions || [];
            if (decisions.length > 0) {
                document.getElementById('decisionsSection').classList.remove('hidden');
                document.getElementById('decisionsList').innerHTML = decisions
                    .map(d => {
                        // Clean up decisions - remove leading dashes/bullets
                        const cleaned = d.replace(/^[\s\-‚Ä¢*]+/, '').trim();
                        return `<div class="bg-green-50 border-l-4 border-green-500 p-3 rounded"><p class="text-gray-700 text-sm">${cleaned}</p></div>`;
                    })
                    .join('');
            }

            // Action Items
            const actionItems = analysis.action_items || [];
            if (actionItems.length > 0) {
                document.getElementById('actionItemsSection').classList.remove('hidden');
                document.getElementById('actionItemsList').innerHTML = actionItems
                    .map(a => {
                        // Clean up action items - remove leading dashes/bullets
                        const cleaned = a.replace(/^[\s\-‚Ä¢*]+/, '').trim();
                        return `<div class="bg-orange-50 border-l-4 border-orange-500 p-3 rounded"><p class="text-gray-700 text-sm">${cleaned}</p></div>`;
                    })
                    .join('');
            }

            // Discussion Points
            const discussion = analysis.discussion_points || [];
            if (discussion.length > 0) {
                document.getElementById('discussionSection').classList.remove('hidden');
                document.getElementById('discussionList').innerHTML = discussion
                    .map(d => {
                        // Clean up discussion points - remove leading dashes/bullets
                        const cleaned = d.replace(/^[\s\-‚Ä¢*]+/, '').trim();
                        return `<div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded"><p class="text-gray-700 text-sm">${cleaned}</p></div>`;
                    })
                    .join('');
            }
        }

        // Initialize
        checkHealth();
    </script>
</body>
</html>